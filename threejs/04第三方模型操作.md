---
outline: deep

prev:
  text: "blender模型"
  link: "/threejs/03blender模型"
next:
  text: "第三方模型贴图操作"
  link: "/threejs/05第三方模型贴图操作"
---

## 模型网

[sketchfab](https://sketchfab.com/feed)是一个第三方`3d`模型网站，收录很多模型

## 例子

模型使用的是该网站的`Tesla 2018 Model 3`, 对该`模型`进行`隐藏部位`和`换色`操作

### index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>04第三方模型操作</title>
    <script type="module" src="./index.ts"></script>
  </head>
  <style>
    body {
      width: 100vw;
      height: 100vh;
      padding: 0;
      margin: 0;
      overflow: hidden;
    }
    .canva-container {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .colorPick-container {
      width: 40px;
      max-height: calc(100%-40px);
      display: flex;
      flex-direction: column;
      align-content: center;
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
    }
    .modulePick-container {
      width: 120px;
      max-height: calc(100%-40px);
      display: flex;
      flex-direction: column;
      align-content: center;
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
      color: white;
    }
  </style>
  <body>
    <div class="canva-container">
      <canvas id="my-canvas" style="width: 100%; height: 100%"></canvas>
      <div class="colorPick-container"></div>
      <div class="modulePick-container">
        <div>装饰</div>
        <div class="module-item">
          <input type="checkbox" class="modulePick-checkbox" id="wheels" />
          <span>车轮</span>
        </div>
        <div class="module-item">
          <input type="checkbox" class="modulePick-checkbox" id="lights" />
          <span>灯光</span>
        </div>
        <div class="module-item">
          <input type="checkbox" class="modulePick-checkbox" id="chrome" />
          <span>镀铬(铝合金)</span>
        </div>
        <div class="module-item">
          <input type="checkbox" class="modulePick-checkbox" id="interior" />
          <span>内饰</span>
        </div>
        <div class="module-item">
          <input type="checkbox" class="modulePick-checkbox" id="glass" />
          <span>玻璃</span>
        </div>
        <div class="module-item">
          <input type="checkbox" class="modulePick-checkbox" id="bumpers" />
          <span>保险杠</span>
        </div>
      </div>
    </div>
  </body>
</html>
```

### index.ts

使用`threejs`加载模型以及搭建场景

```ts
import * as THREE from "three";
import { OrbitControls } from "three/examples/jsm/controls/OrbitControls.js";
import { GLTFLoader } from "three/examples/jsm/Addons.js";

import colorPick from "./color.ts";
import modulePick from "./module.ts";

// 创建场景
const scene = new THREE.Scene();
const canvas = document.querySelector("#my-canvas") as HTMLCanvasElement;

// 创建相机
const camera = new THREE.PerspectiveCamera(
  100,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(0, 0, 400);
camera.lookAt(0, 0, 0);
scene.add(camera);

// 创建控制器
const controls = new OrbitControls(camera, canvas);
// 自转
controls.autoRotate = true;
// 旋转速度
controls.autoRotateSpeed = 5;

// 创建辅助线
const axesHelper = new THREE.AxesHelper(5);
scene.add(axesHelper);

// 加载模型
const loader = new GLTFLoader();
loader.load("./assets/scene.gltf", (gltf) => {
  // 将加载的模型的场景添加到当前场景中
  scene.add(gltf.scene);
  // 加载颜色处理
  colorPick(scene);
  // 加载汽车模块处理
  modulePick(scene);
});

// 创建灯光
const light = new THREE.AmbientLight(0xffffff, 1);
// light.position.set(1000, 1000, 1000)
scene.add(light);

// 创建渲染器
const render = new THREE.WebGLRenderer({
  canvas: canvas,
  antialias: true,
});
// 设置渲染器的大小
render.setSize(window.innerWidth, window.innerHeight);
// 设置像素比
render.setPixelRatio(window.devicePixelRatio);

const animate = () => {
  requestAnimationFrame(animate);
  render.render(scene, camera);
  controls.update();
};

animate();
```

### color.ts

改变车身颜色

```ts
import * as THREE from "three";

const color = [
  "rgb(255,255,255)",
  "rgb(255,192,203)",
  "rgb(220,20,60)",
  "rgb(138,43,226)",
  "rgb(0,0,255)",
  "rgb(0,191,255)",
  "rgb(0,255,0)",
];

const colorPick = (scene: THREE.Scene) => {
  const dom = document.querySelector(".colorPick-container") as HTMLDivElement;
  color.forEach((color) => {
    const colorItemDom = document.createElement("div");
    colorItemDom.style.width = "40px";
    colorItemDom.style.height = "40px";
    colorItemDom.style.cursor = "pointer";
    colorItemDom.style.marginTop = "10px";
    colorItemDom.style.background = color;
    dom.appendChild(colorItemDom);

    // 添加事件
    colorItemDom.addEventListener("click", (e) => {
      // 获取车架对应的网格
      scene.traverse((child) => {
        if (child instanceof THREE.Mesh && child.name.startsWith("door_")) {
          // 设置所选颜色
          child.material.color.set(color);
        }
      });
    });
  });
};

export default colorPick;
```

### module.ts

控制车子模块的显隐

```ts
import * as THREE from "three";

const modules = {
  wheels: ["wheels", "hub_rb", "hub_rf"], // 车轮
  lights: [
    "pantulans",
    "right_rear_light",
    "left_front_light",
    "indicator_lf",
    "indicator_rf",
    "light_night",
    "indicator_rr",
    "indicator_lr",
    "left_rear_light",
    "revlight_L",
    "light_pantulan",
  ], // 灯光
  chrome: [
    "chrome",
    "chrome1",
    "chrome2",
    "aluminium",
    "aluminium2",
    "back_chrome_light",
  ], // 镀铬 铝合金
  interior: [
    "Seat_Leather_white",
    "Leather_white",
    "Carpet",
    "Carpet_Light",
    "texture_Buttons",
    "LCDs",
    "mirror_inside",
  ], // 内饰
  glass: ["glass"], // 玻璃
  bumpers: ["front_bumper_ok", "rear_bumper_ok", "rear_bumper_movsteer"], // 保险杠
};

const moduleMesh: { [key: string]: THREE.Mesh[] } = {};

const modulePick = (scene: THREE.Scene) => {
  // 获取对应的网格
  scene.traverse((child) => {
    if (child instanceof THREE.Mesh) {
      const meshName = child.name.toLowerCase();
      // 将module结构成[key,value]
      const keyValueList = Object.entries(modules);
      for (const [key, value] of keyValueList) {
        for (const name of value) {
          const partName = name.toLowerCase();
          if (meshName.includes(partName)) {
            if (!moduleMesh[key]) {
              moduleMesh[key] = [];
            }
            moduleMesh[key].push(child);
          }
        }
      }
    }
  });

  console.log(moduleMesh);

  // 获取dom集合
  const checkboxDom = document.querySelectorAll(
    ".modulePick-checkbox"
  ) as NodeListOf<HTMLInputElement>;
  Array.prototype.forEach.call(checkboxDom, (item: HTMLInputElement) => {
    // 初始化全勾选
    item.checked = true;
    item.addEventListener("change", (e) => {
      const checked = item.checked;
      const id = item.id;
      const meshs = moduleMesh[id];
      for (const mesh of meshs) {
        mesh.visible = checked;
      }
    });
  });
};

export default modulePick;
```
