## server 层

在`nuxt`中的`server`层，一共分为三层，最外层是`nuxt`,第二层是`nitro`, 第三层是`h3`。
`server`层和`client`层也是一样的，由固定的`文件目录`去进行构成

- `nitro`: [官网](https://nitro.build/)
- `h3`: [文档](https://h3.dev/)

## server 层文件目录

|-- routes 路由
|-- api 接口
|-- middleware 中间件
|-- event 事件

## 接口

在`nuxt`中创建`接口`，是通过`/server/api`的目录下进行创建

### 接口创建

根据不同的请求方法，创建不同名称的文件,`nuxt`会根据文件名称进行创建不同请求方法的接口。<br />
创建接口时，都是通过`defineEventHandler(回调函数)`进行创建，回调函数中可以进行`event`事件的操作。<br />
`event`事件中包含了`event.context`、`event.node.req`、`event.node.res`、`event.node.req.url`、`event.node.req.method`、`event.node.req.headers`、`event.node.req.query`、`event.node.req.body`等属性。<br />

- `get`请求就是`test.ts`

```ts
/*
 * eventHandler 是一个函数，它返回一个对象
 * event参数包含所有的请求信息
 */
export default defineEventHandler((event) => {
  console.log(event);

  return {
    code: 200,
    message: "get请求成功",
    data: {
      name: "张三",
      age: 18,
    },
  };
  // 也可以返回一个promise
  return Promise.resolve({
    code: 200,
    message: "get请求成功",
    data: {
      name: "张三",
      age: 18,
    },
  });
});
```

- `post`请求就是`test.post.ts`
- `put`请求就是`test.put.ts`
- `delete`请求就是`test.delete.ts`
  其他的请求也是类似`get`请求的创建方式。

### 获取请求信息和动态接口文件

获取请求信息，可以通过`h3`层中的方法进行获取，也可以直接使用`event`事件中的属性进行获取。

1. 创建`/user/api/[id].ts`接口，`id`是动态参数

```ts
export default defineEventHandler(async (event) => {
  // 获取param
  const id = getRouterParam(event, "id");

  // 获取query
  const query = getQuery(event);
  // 获取body
  const body = await readBody(event);

  return Promise.resolve({
    code: 200,
    message: "get请求成功",
    data: {
      id,
      body,
      query,
    },
  });

  // 获取header
  const header = getRequestHeaders(event);
  // 获取cookie
  const cookie = getCookie(event, "token");
  // 获取ip
  const ip = getRequestIP(event);
  // 获取method
  const method = getMethod(event);
  // 获取url
  const url = getRequestURL(event);
  // 获取host
  const host = getRequestHost(event);
  // 获取path
  const path = getRequestPath(event);
  // 获取referer
  const referer = getRequestHeader(event, "referer");
  // 获取user-agent
  const userAgent = getRequestHeader(event, "user-agent");
  // 获取accept
  const accept = getRequestHeader(event, "accept");
  // 获取accept-language
  const acceptLanguage = getRequestHeader(event, "accept-language");
  // 获取accept-encoding
  const acceptEncoding = getRequestHeader(event, "accept-encoding");
  // 获取connection
  const connection = getRequestHeader(event, "connection");
  // 获取upgrade
  const upgrade = getRequestHeader(event, "upgrade");
  // 获取sec-websocket-key
  const secWebSocketKey = getRequestHeader(event, "sec-websocket-key");
  // 获取sec-websocket-version
  const secWebSocketVersion = getRequestHeader(event, "sec-websocket-version");
  // 获取sec-websocket-protocol
  const secWebSocketProtocol = getRequestHeader(
    event,
    "sec-websocket-protocol"
  );
});
```

2. 测试接口
   直接访问`http://localhost:3000/api/user/1`,其中的`[id]`的`id`就是`1`
