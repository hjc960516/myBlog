## 存储层

`nuxt`存储层使用的是`unstorage`,[unstroage 文档](https://unstorage.unjs.io/)

## 测试存储层

用来测试`server`层的`存储层`

### 前端

新建`/pages/storage/index.vue`

```vue
<script setup lang="ts">
// 添加存储
const handleSubmit = async (event: "add" | "get" | "remove" | "clear") => {
  const reqMap: { [key: string]: { url: string; method: string; body?: any } } =
    {
      add: {
        url: "/api/storage/setUserInfo",
        method: "POST",
        body: {
          name: "张三",
          age: 18,
        },
      },
      get: {
        url: "/api/storage/getUserInfo",
        method: "GET",
      },
      remove: {
        url: "/api/storage/removeUserInfo",
        method: "GET",
      },
      clear: {
        url: "/api/storage/clearStorage",
        method: "GET",
      },
    };
  const config: any = {
    method: reqMap[event].method,
  };
  if (reqMap[event]?.body) {
    config.body = reqMap[event].body;
  }
  const data = await $fetch(reqMap[event].url, config);
  console.log(data);
};
</script>

<template>
  <div>
    <div>存储层</div>
    <div>
      <button @click="handleSubmit('add')">添加userInfo</button>
      <button @click="handleSubmit('get')">获取userInfo</button>
      <button @click="handleSubmit('remove')">删除userInfo</button>
      <button @click="handleSubmit('clear')">清空所有</button>
    </div>
  </div>
</template>

<style scoped></style>
```

### 后端

1. 新建`/server/api/storage/setUserInfo.ts`

```ts
export default defineEventHandler(async (event) => {
  const userInfo = await readBody(event);
  // 存储
  useStorage().setItem("userInfo", userInfo);
  return {
    code: 0,
    message: "存储成功",
    data: userInfo,
  };
});
```

2. 新建`/server/api/storage/getUserInfo.ts`

```ts
export default defineEventHandler(async (event) => {
  // 获取存储
  const userInfo = await useStorage().getItem("userInfo");
  if (!userInfo) {
    return {
      code: 1,
      message: "没有userInfo数据",
      data: null,
    };
  }
  return {
    code: 0,
    message: "获取成功",
    data: userInfo,
  };
});
```

3. 新建`/server/api/storage/removeUserInfo.ts`

```ts
export default defineEventHandler(async (event) => {
  // 获取存储
  await useStorage().removeItem("userInfo");
  return {
    code: 0,
    message: "删除成功",
  };
});
```

4. 新建`/server/api/storage/clearStorage.ts`

```ts
export default defineEventHandler(async (event) => {
  // 获取存储
  await useStorage().clear();
  return {
    code: 0,
    message: "删除所有成功",
  };
});
```
