## 状态管理

在`nuxt`中使用`状态管理`，你可以使用自带的`useState()`进行创建，也可以使用其他`管理状态框架`，例如:`pinia`

## useState 创建

1. 创建`状态管理`,创建`Astores\`目录进行管理
2. 在`nuxt.config.ts`,导入`Astores`

```ts
// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  // 开启ssr，默认是开启的
  ssr: true,
  // 限定发布nuxt版本的时间
  compatibilityDate: "2024-11-01",
  // 是否开启调试工具
  devtools: { enabled: true },
  // 导入依赖
  modules: ["@vant/nuxt"],
  // 扫描目录，自动导入
  imports: {
    dirs: ["Astores"],
  },
});
```

3. 创建和编写`userStore.ts`，使用时，需要的是你创建的`文件名称(userStore)`

```ts
interface UserProps {
  isLogin: boolean;
  username?: string;
}

const useUserStore = () => {
  const store = useState<UserProps>("useUserStore", () => ({ isLogin: false }));
  // 有其他方法，可以继续添加
  return {
    store: store.value,
  };
};

export default useUserStore;
```

4. 在`app.vue`初始化

```vue
<script lang="ts" setup>
// 使用user的状态管理
const { store } = userStore();
// callOnce: 只执行一次，在构架后端时执行
callOnce("init", () => {
  console.log(store);
});
</script>
<template>
  <div>
    <!-- 状态管理 -->
    <NuxtLink to="/login">登录</NuxtLink>
    <div v-if="store.isLogin">{{ store.username }}</div>
    <div v-else>还没登录</div>

    <!-- 路由 相当于vue的 routerview -->
    <NuxtPage />
  </div>
</template>
```

5. 在`pages/login.vue`修改`userStore`的状态

```vue
<script lang="ts" setup>
const login = () => {
  const { store } = userStore();
  store.username = "你好, nuxt!";
  store.isLogin = true;
  navigateTo("/");
};
</script>
<template>
  <div class="container">
    <h1>我是登录页</h1>
    <button @click="login">登录</button>
  </div>
</template>
<style lang="scss" scoped></style>
```

## 使用 pinia 状态管理

1. 安装`pinia`

```sh
npm i pinia @pinia/nuxt
```

2. 在`nuxt.config.ts`导入`pinia`

```ts
// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  // 开启ssr，默认是开启的
  ssr: true,
  // 限定发布nuxt版本的时间
  compatibilityDate: "2024-11-01",
  // 是否开启调试工具
  devtools: { enabled: true },
  // 导入依赖
  modules: ["@vant/nuxt", "@pinia/nuxt"],
  pinia: {
    // autoImports 配置允许你在 stores 文件夹中直接使用 defineStore 而无需显式导入。
    autoImports: ["defineStore", "acceptHMRUpdate"], // 自动导入 defineStore 和 HMR 支持
  },
  // 扫描目录，自动导入
  imports: {
    dirs: ["Astores"],
  },
});
```

3. 新建`stores\`目录，用来存放`pinia状态管理模块`

4. 新建`stores/testPinia.ts`用来测试

```ts
export const useCounterStore = defineStore("counter", {
  state: () => ({
    counter: 0,
  }),
  actions: {
    increment() {
      this.counter++;
    },
    decrement() {
      this.counter--;
    },
  },
  getters: {
    doubleCount: (state) => state.counter * 2,
  },
});
```

5. 使用，如果使用`vue`中`pinia`，那么用法也是一样的, 首先在`login.vue`使用`pinia`

```vue
<script lang="ts" setup>
import { useCounterStore } from "@/stores/testPinia";

// 使用 pinia 状态管理
const piniaStore = useCounterStore();

// 使用的是 useState 创建的 状态管理
const login = () => {
  const { store } = userStore();
  store.username = "你好, nuxt!";
  store.isLogin = true;
  navigateTo("/");
};
</script>
<template>
  <div class="container">
    <h1>我是登录页</h1>
    <button @click="login">登录</button>
    <h1>当前的pinia的counter是----------{{ piniaStore.counter }}</h1>
    <button @click="piniaStore.increment()">调用pinia的increment</button>
  </div>
</template>
<style lang="scss" scoped></style>
```

6. 在`app.vue`中使用`pinia`，查看`counter`有没有同步

```vue
<script lang="ts" setup>
import { useCounterStore } from "@/stores/testPinia";

// 使用 pinia 状态管理
const piniaStore = useCounterStore();

// 使用useState的user的状态管理
const { store } = userStore();
// callOnce: 只执行一次，在构架后端时执行
callOnce("init", () => {
  console.log(store);
});
</script>
<template>
  <div>
    <!-- 状态管理 -->
    <NuxtLink to="/login">登录</NuxtLink>
    <div v-if="store.isLogin">{{ store.username }}</div>
    <div v-else>还没登录</div>
    <div>当前的pinia的counter是----------{{ piniaStore.counter }}</div>

    <!-- 路由 相当于vue的 routerview -->
    <NuxtPage />
  </div>
</template>
```
