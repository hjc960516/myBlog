## veeValidate

[veeValidate 官网](https://vee-validate.logaretm.com/v4/guide/overview/)<br />
`veeValidate`是一个基于`Vue`的表单验证库，它可以帮助我们快速、方便地验证表单数据。

### 优点

- 支持`数据跟踪`、`验证`、`异步验证`、`支持多种第三方验证工具(如：zod)`
- 是一个轻量级的库，它的体积很小，只需要几十 KB。
- API 简单易用，让我们可以快速地验证表单数据。
- 支持多种验证规则，包括必填、长度、格式等。
- 还支持自定义验证规则，让我们可以根据自己的需求来验证表单数据。
- 还支持国际化，让我们可以根据不同的语言来显示错误信息。
- ...

### 两种方式

- 组件方式

```vue
<template>
  <Field name="field" type="text" />
</template>
<script setup>
import { Field } from "vee-validate";
</script>
```

- API 方式

```ts
import { useForm } from "vee-validate";
interface LoginForm {
  email: string;
  password: string;
}
// in your setup
const { errors, setErrors, setFieldValue } = useForm<LoginForm>();
errors.value; // typed as { email?: string; password?: string }
setErrors({
  email: "This field is invalid", // auto-complete for `email` and `password`
});
setFieldValue("email", "example@gmail.com"); // auto-complete for the field name and its value type
```

### 安装

```sh
# 自定义安装
npm install vee-validate --save
## 安装zod
npm install zod @vee-validate/zod

## nuxt安装
npm i @vee-validate/nuxt
```

### 导入和配置(只有安装的@vee-validate/nuxt 时需要配置)

在`nuxt.config.ts`中导入和配置`vee-validate`

```ts
// https://nuxt.com/docs/api/configuration/nuxt-config
export default defineNuxtConfig({
  // 开启ssr，默认是开启的
  ssr: true,
  // 限定发布nuxt版本的时间
  compatibilityDate: "2024-11-01",
  // 是否开启调试工具
  devtools: { enabled: true },
  // 导入依赖
  modules: [
    "@pinia/nuxt",
    "nuxt-mongoose",
    "@nuxtjs/tailwindcss",
    "@vant/nuxt",
    "@vee-validate/nuxt", // 导入时，需要看你安装的模块名称
  ],
  // 配置vee-validate
  veeValidate: {
    // disable or enable auto imports
    autoImports: true,
    // Use different names for components
    componentNames: {
      Form: "VeeForm",
      Field: "VeeField",
      FieldArray: "VeeFieldArray",
      ErrorMessage: "VeeErrorMessage",
    },
  },
});
```

### 整表单数据验证

当所有需要验证的字段都在同一个表单中使用时，可以使用`useForm`来设置表单数据。
使用`@vee-validate/zod`的`toTypedSchema`对`useForm`进行约束和验证。
使用`zod`去定义表单数据的类型和验证规则。

```vue
<template>
  <div>
    <div>我是VeeValidate结合zod验证页面</div>
    <div>
      <div>当前的<span class="text-red-700">values</span>是{{ values }}</div>
      <div>当前的<span class="text-red-700">errors</span>是{{ errors }}</div>
    </div>
    <form>
      <div>
        <label name="accout">账号:</label>
        <input
          class="bg-white border"
          type="text"
          name="accout"
          v-model="accout"
          v-bind="accoutAttrs"
        /><br />
        <div class="text-red-700 text-xs" v-if="errors.accout">
          {{ errors.accout }}
        </div>
      </div>
      <div>
        <label name="password">密码:</label>
        <input
          class="bg-white border"
          type="text"
          name="password"
          v-model="password"
          v-bind="passwordAttrs"
        /><br />
        <div class="text-red-700 text-xs" v-if="errors.password">
          {{ errors.password }}
        </div>
      </div>
      <button
        class="bg-blue-500 border-blue-700 text-white! px-3 py-1"
        @click="submit"
      >
        提交
      </button>
    </form>
  </div>
</template>

<script setup lang="ts">
import { useForm } from "vee-validate";
import { toTypedSchema } from "@vee-validate/zod";
import { z } from "zod";
// 定义表单验证
const schema = z.object({
  accout: z.string().email({ message: "邮箱格式不正确" }),
  password: z.string().min(6, "密码长度不能小于6"),
});

/**
 * 定义字段：useForm(config)
 * 1. values: 字段集合，响应式
 * 2. defineField: 定义字段
 * 3. errors: 错误集合，响应式
 * 4. handleSubmit: 表单提交处理
 * 5. meta: 元数据，响应式
 * 6. isValidating: 是否正在验证，响应式
 * 7. resetForm: 重置表单
 * 8. resetField: 重置验证错误信息
 * 9. isFieldValid: 是否验证通过
 * 10. isFieldDirty: 是否输入过
 *
 * config字段的属性：
 * 1. validationSchema: 验证规则, 配合toTypedSchema去使用zod验证
 */
const {
  values,
  defineField,
  errors,
  handleSubmit,
  meta,
  isValidating,
  resetForm,
  resetField,
  isFieldValid,
  isFieldDirty,
} = useForm({
  validationSchema: toTypedSchema(schema),
});

/**
 * 定义字段：defineField(字段名称, config)
 * 返回一个数组
 * 数组的第一个元素是字段的值，使用v-model绑定
 * 数组的第二个元素是字段的属性，使用v-bind绑定
 *
 * 字段的属性：
 * 1. validateOnModelUpdate: 是否数值更新时触发，默认true
 * 2. validateOnBlur: 是否在输入框失去焦点时验证，默认true
 * 3. validateOnInput: 是否在输入框输入时验证，默认false
 * 4. validateOnChange: 是否在输入框输入时验证，默认false
 */
const [accout, accoutAttrs] = defineField("accout", {
  validateOnModelUpdate: false,
});
const [password, passwordAttrs] = defineField("password", {
  validateOnModelUpdate: false,
});

// 提交验证, 验证通过才可以提交
const submit = handleSubmit(async (values) => {
  // values是所有表单值
  console.log("submit", values);
});
</script>

<style scoped></style>
```

### 单独验证单个字段

使用`useField`来验证单个字段。
区别是`验证单个数据时`，表单是通过`v-bind`绑定所有事件，而`单数据验证`是需要`手动`进行配置对应事件

#### 封装组件

```vue
<template>
  <div>
    <label :name="name">{{ label }}:</label>
    <input
      class="bg-white border"
      :type="type || 'text'"
      :name="name"
      :placeholder="placeholder || '请输入'"
      v-model="value"
      @blur="handleChange"
    /><br />
    <div class="text-red-700 text-xs" v-if="errorMessage">
      {{ errorMessage }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { useField } from "vee-validate";

interface Props {
  name: string; // 字段名
  label: string; // 标签名
  type?: string; // 输入框类型
  placeholder?: string; // 输入框占位符
}
const props = defineProps<Props>();
/**
 * 设置字段
 * 1. value: 字段值
 * 2. meta: 字段元数据
 * 3. errorMessage: 字段错误信息
 * 4. handleChange: 字段值改变时触发
 * 5. handleBlur: 字段失去焦点时触发
 * 6. resetField: 重置字段
 * 7. handleReset: 重置字段
 */
const {
  value,
  meta,
  errorMessage,
  handleChange,
  handleBlur,
  resetField,
  handleReset,
} = useField(() => props.name);
</script>

<style lang="scss" scoped></style>
```

#### 使用组件

```vue
<template>
  <div>
    <div>我是VeeValidate结合zod验证页面</div>
    <div>
      <div>当前的<span class="text-red-700">values</span>是{{ values }}</div>
      <div>当前的<span class="text-red-700">errors</span>是{{ errors }}</div>
    </div>
    <form>
      <div>
        <div class="text-red-700">使用单属性验证</div>
        <CustomVeeValidate name="phone" label="电话" />
      </div>
      <button
        class="bg-blue-500 border-blue-700 text-white! px-3 py-1"
        @click="submit"
      >
        提交
      </button>
    </form>
  </div>
</template>

<script setup lang="ts">
import { useForm } from "vee-validate";
import { toTypedSchema } from "@vee-validate/zod";
import { z } from "zod";
// 定义表单验证
const schema = z.object({
  phone: z.string().min(11, "电话长度不能小于11"),
});

/**
 * 定义字段：useForm(config)
 * 1. values: 字段集合，响应式
 * 2. defineField: 定义字段
 * 3. errors: 错误集合，响应式
 * 4. handleSubmit: 表单提交处理
 * 5. meta: 元数据，响应式
 * 6. isValidating: 是否正在验证，响应式
 * 7. resetForm: 重置表单
 * 8. resetField: 重置验证错误信息
 * 9. isFieldValid: 是否验证通过
 * 10. isFieldDirty: 是否输入过
 *
 * config字段的属性：
 * 1. validationSchema: 验证规则, 配合toTypedSchema去使用zod验证
 */
const { values, handleSubmit, errors } = useForm({
  validationSchema: toTypedSchema(schema),
});

// 提交验证, 验证通过才可以提交
const submit = handleSubmit(async (values) => {
  // values是所有表单值
  console.log("submit", values);
});
</script>

<style scoped></style>
```
