## 路由的使用和获取

熟悉`vue`的都知道`useRoute`和`useRouter`两个函数，`nuxt`中也是同样的使用方法

1. `useRoute`
   `useRoute`是用来获取路由信息的

```ts
// 获取当前路由的信息
const route = useRoute();
```

2. `useRouter`
   `useRouter`是用来操作路由的

```ts
// 可以使用使用该实例来操作路由
const router = useRouter();
```

## 路由

在`xxx.vue`中使用`<NuxtLink to="/">首页</NuxtLink>`即可进行跳转，有学过`vue`的应该很熟悉了

```vue
<!-- app.vue -->

<script lang="ts" setup></script>
<template>
  <div>
    <!-- 自定义测试components自动导入组件 -->
    <testComponents message="我是传过来的信息啊" />

    <NuxtRouteAnnouncer />
    <!-- <NuxtWelcome /> -->

    <!-- 首页, 自动查询/pages/index/index.vue 相当于 vue 的 routerlink -->
    <NuxtLink to="/">首页</NuxtLink>
    <NuxtLink to="/users">users页</NuxtLink>
    <NuxtLink to="/users/2">users下的详情页</NuxtLink>
    <!-- 路由 相当于vue的 routerview -->
    <NuxtPage />
  </div>
</template>
```

## 中间件

熟悉后端的应该都很熟悉`中间件`，主要是用来操作某事情之前做一些操作。

- 在`nuxt`中，有三种中间件类型:

  1. 在`middleware`文件夹中创建单独文件，在页面中使用`definePageMeta({middleware:['xxx']})`定义注册中间件，需要与`文件名一致`
  2. 直接在`definePageMeta`中使用`inline function`进行定义
  3. 全局中间件: 带有后缀`.global`，在每个路由都会运行

- `运行顺序`是: `全局中间件(按字母)` -> `页面中间件(按数组)`
- `修改全局中间件顺序`: 添加数字前缀，实际上是根据`修改middleware目录文件排序`并且没被注册为`单中间件`的顺序

### 第一种

1. 在`middleware/`目录下新建`verify.ts`, 该例子配合前面的`users/id`动态路由使用

```ts
/**
 * 定义验证中间件
 * @params to 去的路由
 * @params from 来的路由
 */
export default defineNuxtRouteMiddleware((to, form) => {
  /**
   * 模拟请求权限
   */
  const fetchFn = () => {
    return to.params?.id === "1";
  };
  // 没通过验证，跳转到login
  if (fetchFn() === false) {
    // navigateTo: 跳转路由
    // return navigateTo('/login')
    // abortNavigation: 阻止跳转，可传入错误信息
    return abortNavigation("错误路由");
  }
});
```

2. 使用

使用中间件, 在页面中使用`definePageMeta({middleware:['xxx']})`注册中间件

```vue
<!-- [id].vue -->

<script lang="ts" setup>
definePageMeta({
  // 使用验证中间件
  middleware: ["verify"],
});
</script>
<template>
  <div class="container">
    <h1>我是 动态id 页面</h1>
  </div>
</template>
<style lang="scss" scoped></style>
```

### 第二种

直接在`definePageMeta()`中的`middleware`数组使用`函数`

```vue
<!-- [id].vue -->
<script lang="ts" setup>
definePageMeta({
  // 使用验证中间件, 执行顺序为数组顺序
  middleware: [
    // 直接使用函数作为中间件
    (to, from) => {
      console.log(to.params.id);
    },
    // 该中间件是在 middleware 文件夹下的
    "verify",
  ],
});
</script>
<template>
  <div class="container">
    <h1>我是 动态id 页面</h1>
  </div>
</template>
<style lang="scss" scoped></style>
```

### 第三种

在`middleware`目录下，创建`test.global.ts`全局中间件, 如果有多个`全局中间件`, 默认会按照`字母顺序执行`, 如果需要`自定义执行顺序`, 只需要将`文件名`前面添加`数字`, 例如：`1.test.global.ts`、`2.about.global.ts`

```ts
export default defineNuxtRouteMiddleware((to, form) => {
  console.log(`我是全局中间件，所有路由都经过我`);
});
```
