## rxjs

rxjs 是 nestjs 自带的

1. RxJS 是使用 Observables 的响应式编程的库，它使编写异步或基于回调的代码更容易
2. RxJs 使用的是观察者模式，用来编写异步队列和事件处理。
3. Observable 可观察的物件
4. Subscription 监听 Observable
5. Operators 纯函数可以处理管道的数据 如 map filter concat reduce 等

## 案例

1. 类似于迭代器 next 发出通知 complete 通知完成, subscribe 订阅 observable 发出的通知 也就是一个观察者

```ts
import { Observable } from "rxjs";

/**
 * 类似于迭代器 next 发出通知 complete 通知完成
 * subscribe 订阅 observable 发出的通知 也就是一个观察者
 */
// 发出通知并完成
const observable = new Observable((subscribe) => {
  // 通过next()发出通知
  subscribe.next(1);
  subscribe.next(2);
  subscribe.next(3);
  subscribe.next(4);
  subscribe.next(5);
  subscribe.next(6);
  // 完成发送
  // subscribe.complete()

  setTimeout(() => {
    subscribe.next(7);
    subscribe.complete();
  }, 3000);
});

// 订阅上面发出的通知, 会等待subscribe.complete()触发完成发送后才会结束该observable的观测
observable.subscribe({
  next(value) {
    console.log(value);
  },
});
```

2. pipe 通道处理数据
   interval 五百毫秒执行一次 pipe 就是管道的意思 管道里面也是可以去掉接口的支持处理异步数据 去处理数据 这儿展示 了 map 和 filter 跟数组的方法是一样的 最后 通过观察者 subscribe 接受回调

```ts
import { Observable, interval } from "rxjs";
import { map, filter, reduce, find, findIndex } from "rxjs/operators";

/**
 * interval 五百毫秒执行一次 pipe 就是管道的意思 管道里面也是可以去掉接口的支持处理异步数据 去处理数据 这儿展示 了 map  和 filter 跟数组的方法是一样的  最后 通过观察者  subscribe 接受回调
 */
// 300毫秒执行一次
const sub = interval(300)
  // 通道，可做多个处理，pipe(xxx,xxxx,xxxx)
  .pipe(
    map((value, index) => {
      // console.log(value, index);
      return {
        value,
        index,
      };
    }),
    // 对map的数据做再处理
    filter((value) => value.index % 2 == 0)
  )
  // 监听通道
  .subscribe((value) => {
    console.log(value);

    if (value.index >= 20) {
      // 断开观测
      sub.unsubscribe();
    }
  });
```

3. 处理事件
   处理事件 不过我们在 Nestjs 里面就不用操作 DOM 了 你如果 Angular 或则 Vue 框架看可以使用 fromEvent

```ts
import { fromEvent } from "rxjs";
import { map } from "rxjs/operators";

/**
 * 处理事件 不过我们在Nestjs 里面就不用操作DOM 了 你如果Angular 或则 Vue 框架看可以使用  fromEvent
 */

const dom = fromEvent(document, "click").pipe(map((v) => v.target));

dom.subscribe((e) => {
  // 对点击事件做点其他事情
});
```
