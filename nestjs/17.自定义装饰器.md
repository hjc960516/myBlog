## 装饰器

Nest 是围绕一种称为`装饰器`的语言功能构建的。装饰器是许多常用编程语言中的一个众所周知的概念，但在 JavaScript 世界中，它们仍然相对较新

## 官方提供的一些装饰器

只列举部分，具体请看官方文档

|         装饰器          |         传过来的参数          |
| :---------------------: | :---------------------------: |
|   @Request(), @Req()    |              req              |
|   @Response(), @Res()   |              res              |
|         @Next()         |             next              |
|       @Session()        |          req.session          |
|  @Param(key?: string)   |  req.params/req.params[key]   |
|   @Body(key?: string)   |    req.body/req.body[key]     |
|  @Query(key?: string)   |   req.query/req.query[key]    |
| @Headers(name?: string) | req.headers/req.headers[name] |
|       @HttpCode()       |       返回给前端的 code       |
|          @Ip()          |            req.ip             |
|      @HostParam()       |           req.hosts           |

## 自定义装饰器

除了官方提供的装饰器，你还可以自己定制装饰器

### 创建装饰器

```sh
nest g [d | decorator] [name]
```

### 案例

1. 自定义权限装饰器

```ts
import { SetMetadata } from "@nestjs/common";

// 自定义权限装饰器
export const Decorator = (...args: string[]) => {
  console.log(args, 11111111);

  return SetMetadata("decorator", args);
};
```

2. 自定义参数装饰器

```ts
import {
  SetMetadata,
  createParamDecorator,
  ExecutionContext,
} from "@nestjs/common";
import { Request } from "express";

// 自定义参数装饰器
export const DecoratorParams = createParamDecorator(
  (key: any = "", context: ExecutionContext) => {
    console.log(key);
    const req = context.switchToHttp().getRequest<Request>();
    return key ? req?.params[key] : req.params;
  }
);
```

3. 使用自定义装饰器

```ts
// decorator.controller.ts

import {
  Controller,
  Get,
  Post,
  Body,
  Patch,
  Param,
  Delete,
} from "@nestjs/common";
import { DecoratorService } from "./decorator.service";
import { CreateDecoratorDto } from "./dto/create-decorator.dto";
import { UpdateDecoratorDto } from "./dto/update-decorator.dto";
import { Decorator, DecoratorParams } from "./decorator.decorator";

@Controller("decorator")
export class DecoratorController {
  constructor(private readonly decoratorService: DecoratorService) {}

  @Post()
  create(@Body() createDecoratorDto: CreateDecoratorDto) {
    return this.decoratorService.create(createDecoratorDto);
  }

  @Get()
  @Decorator("name", "admin") // 自定义权限装饰器
  findAll() {
    return this.decoratorService.findAll();
  }

  @Get(":id")
  // @DecoratorParams() 自定义参数装饰器
  findOne(@Param("id") id: string, @DecoratorParams("id") paramsId: any) {
    console.log(paramsId, 111111111);

    return this.decoratorService.findOne(+id);
  }

  @Patch(":id")
  update(
    @Param("id") id: string,
    @Body() updateDecoratorDto: UpdateDecoratorDto
  ) {
    return this.decoratorService.update(+id, updateDecoratorDto);
  }

  @Delete(":id")
  remove(@Param("id") id: string) {
    return this.decoratorService.remove(+id);
  }
}
```
